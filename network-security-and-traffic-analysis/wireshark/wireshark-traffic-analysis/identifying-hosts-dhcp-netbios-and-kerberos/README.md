# Identifying Hosts: DHCP, NetBIOS and Kerberos

## Identifying Hosts

One of the best methods is identifying the hosts and users on the network to decide the investigation's starting point and list the hosts and users associated with the malicious traffic/activity.



## Dynamic Host Configuration Protocol (DHCP) Analysis

Responsible for managing automatic IP address and required communication parameters assignment

| Notes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Wireshark Filter                                                                                                                                                                |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Global search.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | <ul><li><code>dhcp</code> or <code>bootp</code></li></ul>                                                                                                                       |
| <p>Filtering the proper DHCP packet options is vital to finding an event of interest. <br><br></p><ul><li>"DHCP Request" packets contain the hostname information</li><li>"DHCP ACK" packets represent the accepted requests</li><li>"DHCP NAK" packets represent denied requests</li></ul><p>Due to the nature of the protocol, only "Option 53" ( request type) has predefined static values. You should filter the packet type first, and then you can filter the rest of the options by "applying as column" or use the advanced filters like "contains" and "matches".<br></p> | <ul><li>Request: <code>dhcp.option.dhcp == 3</code></li></ul><ul><li>ACK: <code>dhcp.option.dhcp == 5</code></li></ul><ul><li>NAK: <code>dhcp.option.dhcp == 6</code></li></ul> |

| <p>"DHCP Request" options for grabbing the low-hanging fruits:</p><ul><li>Option 12: Hostname.</li><li>Option 50: Requested IP address.</li><li>Option 51: Requested IP lease time.</li><li>Option 61: Client's MAC address.</li></ul> | <ul><li><code>dhcp.option.hostname contains "keyword"</code></li></ul>                                                                                                                                                                  |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p>"DHCP ACK" options for grabbing the low-hanging fruits:</p><ul><li>Option 15: Domain name.</li><li>Option 51: Assigned IP lease time.</li></ul>                                                                                     | <ul><li><code>dhcp.option.domain_name contains "keyword"</code></li></ul>                                                                                                                                                               |
| <p>"DHCP NAK" options for grabbing the low-hanging fruits:</p><ul><li>Option 56: Message (rejection details/reason).</li></ul>                                                                                                         | As the message could be unique according to the case/situation, It is suggested to read the message instead of filtering it. Thus, the analyst could create a more reliable hypothesis/result by understanding the event circumstances. |



## NetBIOS (NBNS) Analysis

Technology responsible for allowing applications on different hosts to communicate with each other.&#x20;

| Notes                                                                                                                                                                                     | Wireshark Filter                                            |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------- |
| Global search.                                                                                                                                                                            | <ul><li><code>nbns</code></li></ul>                         |
| <p>"NBNS" options for grabbing the low-hanging fruits:</p><ul><li>Queries: Query details.</li><li>Query details could contain "name, Time to live (TTL) and IP address details"</li></ul> | <ul><li><code>nbns.name contains "keyword"</code></li></ul> |



## Kerberos Analysis

**Kerberos** is the default authentication service for Microsoft Windows domains. It is responsible for authenticating service requests between two or more computers over the untrusted network. The ultimate aim is to prove identity securely.

| Notes                                                                                                                                                                                                                                                                                                                                                                      | Wireshark Filter                                                                                                                                                              |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Global search.                                                                                                                                                                                                                                                                                                                                                             | <ul><li><code>kerberos</code></li></ul>                                                                                                                                       |
| <p>User account search:</p><ul><li>CNameString: The username.</li></ul><p><strong>Note:</strong> Some packets could provide hostname information in this field. To avoid this confusion, filter the "$" value. The values end with "$" are hostnames, and the ones without it are user names.<br></p>                                                                      | <ul><li><code>kerberos.CNameString contains "keyword"</code> </li><li><code>kerberos.CNameString and !(kerberos.CNameString contains "$" )</code></li></ul>                   |
| <p>"Kerberos" options for grabbing the low-hanging fruits:</p><ul><li>pvno: Protocol version.</li><li>realm: Domain name for the generated ticket.<br></li><li>sname: Service and domain name for the generated ticket.</li><li>addresses: Client IP address and NetBIOS name.<br></li></ul><p>Note: the "addresses" information is only available in request packets.</p> | <ul><li><code>kerberos.pvno == 5</code></li></ul><ul><li><code>kerberos.realm contains ".org"</code> </li></ul><ul><li><code>kerberos.SNameString == "krbtg"</code></li></ul> |
